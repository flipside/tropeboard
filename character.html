
<html>
<head>
  <meta charset="utf-8">
  <title>Tropeboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Le styles -->
  <link href="./bootstrap/css/bootstrap.css" rel="stylesheet">
  <style type="text/css">
    body {
      padding-top: 60px;
      padding-bottom: 40px;
    }
  </style>
  <link href="./bootstrap/css/bootstrap-responsive.css" rel="stylesheet">
  <link href="./bootstrap/css/bootstrap-overwride.css" rel="stylesheet">

  <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <!-- Fav and touch icons -->
  <link rel="shortcut icon" href="../assets/ico/favicon.ico">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
  <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">
  <script type="text/javascript" src="https://static.firebase.com/v0/firebase.js"></script>
  <script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js'></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js"></script>
</head>
<body>
  <div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <a data-toggle="collapse" data-target=".nav-collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span></a>
          <a href="./index.html" class="brand">Tropeboard</a>
          <div class="nav-collapse">
            <ul class="nav">
              <li><a href="./index.html">Home</a></li>
              <li><a href="./tropeboard.html">Tropeboards</a></li>
              <li><a href="./character.html">Characters</a></li>
              <li><a href="./users.html">Users</a></li>
              <li><a href="./tropes.html">Tropes</a></li>
            </ul>
            <ul class="nav pull-right">
              <li class="dropdown"><a href="#" data-toggle="dropdown" class="dropdown-toggle">guest <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li class=""><a href="/users/edit">Account</a></li>
                <li><a href="/sessions/destroy">Log Out</a></li></ul></li>
            </ul>
            <p class="navbar-text pull-right">Welcome</p>
          </div>
      </div>
    </div>
  </div>
  <div class="container">
    <div class="row">
      <h2>Characters</h2>
      <form class="form-inline">
        <input type="text" id='newCharName' placeholder="New Character Name">
        <button class="btn btn-primary" id="createChar" type="button">Create New Character</button>
      </form>
      <p>
      <div class="row-fluid">
        <div class="tabbable tabs-left">
          <ul class="nav nav-tabs span3">
            <li class="active"><a href="#tb1-characters-char0" data-toggle="tab">Some Guy</a></li>
            <li><a href="#tb1-characters-char1" data-toggle="tab">Random Girl</a></li>
            <li><a href="#tb1-characters-char2" data-toggle="tab">That Kid</a></li>
          </ul>
          <div class="tab-content">
            <div class="tab-pane active" id="tb1-characters-char0">

              <div class="row-fluid">
                <div class="tabbable tabs-left">
                  <ul class="nav nav-tabs span4">
                    <li class="active"><a href="#tb1-characters-char0-characterization" data-toggle="tab">Characterization</a></li>
                    <li><a href="#tb1-characters-char0-motivation" data-toggle="tab">Motivation</a></li>
                    <li><a href="#tb1-characters-char0-backstory" data-toggle="tab">Backstory</a></li>
                  </ul>
                  <div class="tab-content">
                    <div class="tab-pane active" id="tb1-characters-char0-characterization">
                      <div class="row-fluid">
                        <div class="span6">
                          <h4>Selected</h4>
                          <div id="SelectedTropes">
                          </div>
                        </div>
                        <div class="span6">
                          <h4>Available Tropes</h4>
                          <div id="AvailableTropes">
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="tab-pane" id="tb1-characters-char0-motivation">
                      <p>Howdy, I'm the setting.</p>
                    </div>
                    <div class="tab-pane" id="tb1-characters-char0-backstory">
                      <p>Howdy, I'm the plot</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="tab-pane" id="tb1-characters-char1">
              <p>Howdy, I'm the setting.</p>
            </div>
            <div class="tab-pane" id="tb1-characters-char2">
              <p>Howdy, I'm the plot</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <h3>Characterization Tropes</h3>
      <div class="span4">
        <input type="text" id='characterizationInput' placeholder="New Trope">
      </div>
      <div class="span8">
        <div id='characterizationTropes'></div>
      </div>
    </div>
    <div class="row">
      <h3>Plot Tropes</h3>
      <div class="span4">
        <input type="text" id='plotInput' placeholder="New Trope">
      </div>
      <div class="span8">
        <div id='plotTropes'></div>
      </div>
    </div>
    <h3>Other Tropes</h3>
    <div id='messagesDiv'></div>
    <input type='text' id='nameInput' placeholder='Name'>
    <input type='text' id='messageInput' placeholder='Message...'>
  </div></body>
<script type="text/javascript">
$(document).ready(function() {

  var tropeboardRef = new Firebase('https://tropeboard.firebaseio.com/');
  // var tropeboardController = new Tropeboard.Controller(tropeboardRef);

  // $('#tab1').click(function (e) {
  //   e.preventDefault();
  //   $(this).tab('show');
  // });

  // $('#tab2').click(function (e) {
  //   e.preventDefault();
  //   $(this).tab('show');
  // });
  // Add a callback that is triggered for each chat message.
  tropeboardRef.child('tropes').child('characterization').on('child_added', function (snapshot) {
    var trope = snapshot.val();
    $('<div/>').text(trope.name).appendTo($('#SelectedTropes'));
    // $('#selectedTropes')[0].scrollTop = $('#selectedTropes')[0].scrollHeight;
  });

  tropeboardRef.child('tropes').child('characterization').on('child_added', function (snapshot) {
    var trope = snapshot.val();
    // $('<div/>').text(trope.name).appendTo($('#AvailableTropes'));
    var li = $("<div><a></a></div>");

    $("#AvailableTropes").append(li);

    $("a",li).text(trope.name);
    $("a",li).attr("href", "#" + trope.name);
    $("a",li).attr("class", "at");
    // $('<li/>').text('<a href="#" id="'+trope.name+'">'+trope.name+'</a>').appendTo($('#AvailableTropes'));
    // $('#selectedTropes')[0].scrollTop = $('#selectedTropes')[0].scrollHeight;
  });

  $("#AvailableTropes.at").on('click', 'div', function () {
    $("#AvailableTropes div.clicked").removeClass("clicked").appendTo('#SelectedTropes');
  });

  $("#SelectedTropes").on('click', 'div', function () {
    $("#SelectedTropes div.clicked").removeClass("clicked").appendTo('#AvailableTropes');
  });

  $('#createChar').on('click', function () {
    tropeboardRef.child('characters').push({name: 'test', tropes: []});
  });

  $('#messageInput').keypress(function (e) {
    if (e.keyCode == 13) {
      var name = $('#nameInput').val();
      var text = $('#messageInput').val();
      tropeboardRef.child('message').push({name:name, text:text});
      $('#messageInput').val('');
    }
  });

  // Add a callback that is triggered for each chat message.
  tropeboardRef.child('message').on('child_added', function (snapshot) {
    var message = snapshot.val();
    // var parent = snapshot.parent().toString();
    $('<div/>').text(message.text).prepend($('<em/>').text(message.name+': ')).appendTo($('#messagesDiv'));
    $('#messagesDiv')[0].scrollTop = $('#messagesDiv')[0].scrollHeight;
  });

  function renderCharacterizationTrope(snap) {
    console.log('characterization trope: ' + snap.child('name').val());
  }

  function renderCharacter(snap) {
    console.log('character name: ' + snap.child('name').val());
    snap.child('tropes').forEach(function(childSnap) {
      foo.child('characterization_tropes').child(childSnap.val()).on('value', renderCharacterizationTrope);
    });
  }

  // foo.child('characters').child('-IhNyUmZnESSEXCX_gQO').on('value', renderCharacter);

  // foo.child('characters').child('-IhNyUmZnESSEXCX_gQO').child('tropes').push('-IhNyHnSAn9U-HDGP7nB');

})

</script>
<script src="./bootstrap/js/bootstrap.min.js"></script>
</body>
</html>