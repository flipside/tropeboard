
<html>
<head>
  <meta charset="utf-8">
  <title>Tropeboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Le styles -->
  <link href="./bootstrap/css/bootstrap.css" rel="stylesheet">
  <style type="text/css">
    body {
      padding-top: 60px;
      padding-bottom: 40px;
    }
  </style>
  <link href="./bootstrap/css/bootstrap-responsive.css" rel="stylesheet">
  <link href="./bootstrap/css/bootstrap-overwride.css" rel="stylesheet">

  <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <!-- Fav and touch icons -->
  <link rel="shortcut icon" href="../assets/ico/favicon.ico">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
  <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">
  <script type="text/javascript" src="https://static.firebase.com/v0/firebase.js"></script>
  <script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js'></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js"></script>
</head>
<body>
  <div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <a data-toggle="collapse" data-target=".nav-collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span></a>
          <a href="./index.html" class="brand">Tropeboard</a>
          <div class="nav-collapse">
            <ul class="nav">
              <li><a href="./index.html">Home</a></li>
              <li><a href="./tropeboard.html">Tropeboards</a></li>
              <li><a href="./character.html">Characters</a></li>
              <li><a href="./users.html">Users</a></li>
              <li><a href="./tropes.html">Tropes</a></li>
            </ul>
            <ul class="nav pull-right">
              <li class="dropdown"><a href="#" data-toggle="dropdown" class="dropdown-toggle">guest <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li class=""><a href="/users/edit">Account</a></li>
                <li><a href="/sessions/destroy">Log Out</a></li></ul></li>
            </ul>
            <p class="navbar-text pull-right">Welcome</p>
          </div>
      </div>
    </div>
  </div>
  <div class="container">
    <div class="row">
      <div class="tabbable">
        <ul class="nav nav-tabs">
          <li class="active"><a href="#tab1" data-toggle="tab">All Tropeboards</a></li>
          <li><a href="#tab2" data-toggle="tab">My Tropebords</a></li>
        </ul>
        <div class="tab-content">
          <div class="tab-pane" id="tab2">
            <h3>Here's all your tropeboards</h3>
            <p>

              <div class="input-append">
                <input class="span2" id="newTropeboardInput" type="text">
                <button class="btn" id="newTropeboardButton" type="button">Create New Tropeboard</button>
              </div>
            </p>
            <br />
            <div class="row">
              <div class="tabbable tabs-left">
                <ul class="nav nav-tabs span2">
                  <li class="active"><a href="#tb1" data-toggle="tab">My Tropetastic Story</a></li>
                  <li><a href="#tb2" data-toggle="tab">My Inspirational Trope</a></li>
                </ul>
                <div class="tab-content">
                  <div class="tab-pane active" id="tb1">

                      <div class="row-fluid">
                      <div class="tabbable tabs-left">
                        <ul class="nav nav-tabs span2">
                          <li class="active"><a href="#tb1-characters" data-toggle="tab">Characters</a></li>
                          <li><a href="#tb1-setting" data-toggle="tab">Setting</a></li>
                          <li><a href="#tb1-plot" data-toggle="tab">Plot</a></li>
                        </ul>
                        <div class="tab-content">
                          <div class="tab-pane active" id="tb1-characters">
                            <input type="text" id='newCharName' placeholder="New Character Name">
                            <button class="btn btn-primary" type="button">Create New Character</button>
                            <p>
                            <div class="row-fluid">
                              <div class="tabbable tabs-left">
                                <ul class="nav nav-tabs span3">
                                  <li class="active"><a href="#tb1-characters-char0" data-toggle="tab">Some Guy</a></li>
                                  <li><a href="#tb1-characters-char1" data-toggle="tab">Random Girl</a></li>
                                  <li><a href="#tb1-characters-char2" data-toggle="tab">That Kid</a></li>
                                </ul>
                                <div class="tab-content">
                                  <div class="tab-pane active" id="tb1-characters-char0">

                                    <div class="row-fluid">
                                      <div class="tabbable tabs-left">
                                        <ul class="nav nav-tabs span4">
                                          <li class="active"><a href="#tb1-characters-char0-characterization" data-toggle="tab">Characterization</a></li>
                                          <li><a href="#tb1-characters-char0-motivation" data-toggle="tab">Motivation</a></li>
                                          <li><a href="#tb1-characters-char0-backstory" data-toggle="tab">Backstory</a></li>
                                        </ul>
                                        <div class="tab-content">
                                          <div class="tab-pane active" id="tb1-characters-char0-characterization">
                                            <div class="row-fluid">
                                              <div class="span6">
                                                <h4>Selected</h4>
                                                <select id="selectedTropes" multiple="multiple">
                                                </select>
                                              </div>
                                              <div class="span6">
                                                <h4>Available Tropes</h4>
                                                <select multiple="multiple">
                                                  <option>Trope</option>
                                                  <option>Trope</option>
                                                  <option>Trope</option>
                                                  <option>Trope</option>
                                                  <option>Trope</option>
                                                </select>
                                              </div>
                                            </div>
                                          </div>
                                          <div class="tab-pane" id="tb1-characters-char0-motivation">
                                            <p>Howdy, I'm the setting.</p>
                                          </div>
                                          <div class="tab-pane" id="tb1-characters-char0-backstory">
                                            <p>Howdy, I'm the plot</p>
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                  <div class="tab-pane" id="tb1-characters-char1">
                                    <p>Howdy, I'm the setting.</p>
                                  </div>
                                  <div class="tab-pane" id="tb1-characters-char2">
                                    <p>Howdy, I'm the plot</p>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                          <div class="tab-pane" id="tb1-setting">
                            <p>Howdy, I'm the setting.</p>
                          </div>
                          <div class="tab-pane" id="tb1-plot">
                            <p>Howdy, I'm the plot</p>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="tab-pane" id="tb2">
                    <p>Howdy, I'm in Section 2.</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="tab-pane active" id="tab1">
            <div class="input-append">
              <input class="span2" type="text">
              <button class="btn" id="createTropeboard" type="button">Create</button>
            </div>
            <br />
            <div class="tabbable tabs-left">
              <ul class="nav nav-tabs span2" id='allTropeboardsList'>
              </ul>
              <div class="tab-content" id='allTropeboardsContent'>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <h3>Characterization Tropes</h3>
      <div class="span4">
        <input type="text" id='characterizationInput' placeholder="New Trope">
      </div>
      <div class="span8">
        <div id='characterizationTropes'></div>
      </div>
    </div>
    <div class="row">
      <h3>Plot Tropes</h3>
      <div class="span4">
        <input type="text" id='plotInput' placeholder="New Trope">
      </div>
      <div class="span8">
        <div id='plotTropes'></div>
      </div>
    </div>
    <h3>Other Tropes</h3>
    <div id='messagesDiv'></div>
    <input type='text' id='nameInput' placeholder='Name'>
    <input type='text' id='messageInput' placeholder='Message...'>
  </div></body>
<script type="text/javascript">
$(document).ready(function() {

  var tropeboardRef = new Firebase('https://tropeboard.firebaseio.com/');
  // var tropeboardController = new Tropeboard.Controller(tropeboardRef);

  // $('#tab1').click(function (e) {
  //   e.preventDefault();
  //   $(this).tab('show');
  // });

  // $('#tab2').click(function (e) {
  //   e.preventDefault();
  //   $(this).tab('show');
  // });
  // Add a callback that is triggered for each chat message.
  tropeboardRef.child('tropes').child('characterization').on('child_added', function (snapshot) {
    var trope = snapshot.val();
    $('<option/>').text(trope.name).appendTo($('#selectedTropes'));
    // $('#selectedTropes')[0].scrollTop = $('#selectedTropes')[0].scrollHeight;
  });

  $('#messageInput').keypress(function (e) {
    if (e.keyCode == 13) {
      var name = $('#nameInput').val();
      var text = $('#messageInput').val();
      tropeboardRef.push({name:name, text:text});
      $('#messageInput').val('');
    }
  });

  // Add a callback that is triggered for each chat message.
  tropeboardRef.child('message').on('child_added', function (snapshot) {
    var message = snapshot.val();
    console.log(message);
    $('<div/>').text(message.text || '').prepend($('<em/>').text(message.name+': ')).appendTo($('#messagesDiv'));
    $('#messagesDiv')[0].scrollTop = $('#messagesDiv')[0].scrollHeight;
  });

  function renderCharacterizationTrope(snap) {
    console.log('characterization trope: ' + snap.child('name').val());
  }

  function renderCharacter(snap) {
    console.log('character name: ' + snap.child('name').val());
    snap.child('tropes').forEach(function(childSnap) {
      foo.child('characterization_tropes').child(childSnap.val()).on('value', renderCharacterizationTrope);
    });
  }

  // foo.child('characters').child('-IhNyUmZnESSEXCX_gQO').on('value', renderCharacter);

  // foo.child('characters').child('-IhNyUmZnESSEXCX_gQO').child('tropes').push('-IhNyHnSAn9U-HDGP7nB');\

  $("#createTropeboard").on('click', function () {
    var name = $(this).prev().val();
    tropeboardRef.child('tropeboards').push({name: name});
    $('#createTropeboardInput').val('');
  });

  function newChar() {
    $(".newChar").click(function () {
    // console.log('test');
    // var name = $(this).parent().child('newCharInput').val()
      throttled($(this));
    });
  }
  var throttled = _.debounce(logRes, 150);

  function logRes(that) {
    var input = that.prev()
    , name = input.val()
    , parent = that.parents(".tropeboard")
    , id = parent.attr('name');
    console.log(id);
    tropeboardRef.child('tropeboards').child(id).child('characters').push({name: name});
    input.val('');

  }

  tropeboardRef.child('tropeboards').on('child_changed', function (snap) {
    console.log(snap.child('characters').val());
  });

  // Add a callback that is triggered for each chat message.
  tropeboardRef.child('tropeboards').on('child_added', function (snapshot) {
    var tropeboard = snapshot.val();
    var name = tropeboard.name;
    var id = snapshot.name();
    var tab = $("<li><a></a></li>");

    $("#allTropeboardsList").append(tab);

    $("a",tab).text(name);
    $("a",tab).attr("href", "#" + name);
    $("a",tab).attr("data-toggle", "tab");

    // var content = $("<div><p></p></div>");
    var charTab = '<div class="row-fluid"><div class="tabbable tabs-left"><ul class="nav nav-tabs span2">'
                  +'<div class="input-append"><input type="text">'
                  +'<button class="btn newChar" type="button">Create</button></div>'
                  +'</ul>'
                  +'<div class="tab-content">'
                  +'</div></div></div>';

    var boardTab = '<div class="row-fluid"><div class="tabbable tabs-left"><ul class="nav nav-tabs span2">'
                  +'<li><a href="#'+name+'_characters" data-toggle="tab">Characters</a></li>'
                  +'<li><a href="#'+name+'_setting" data-toggle="tab">Setting</a></li>'
                  +'<li><a href="#'+name+'_plot" data-toggle="tab">Plot</a></li>'
                  +'</ul>'
                  +'<div class="tab-content">'
                    +'<div class="tab-pane" id="'+name+'_characters">'+charTab+'</div>'
                    +'<div class="tab-pane" id="'+name+'_setting"><p>Setting</p></div>'
                    +'<div class="tab-pane" id="'+name+'_plot"><p>Plot</p></div>'
                  +'</div></div>';


    var newDiv = '<div class="tab-pane tropeboard" id="'+name+'" name="'+id+'">'+boardTab+'</div>';
    $("#allTropeboardsContent").append(newDiv);
    // $('<div/>').text(tropeboard.text).appendTo($("#"+tropeboard.name));
    // $("p",content).text(tropeboard.name);
    // $("div",content).attr("class", "tab-pane active");
    // $("div",content).attr("id", tropeboard.name);

    // $('<div/>').text(tropeboard.text).prepend($('<em/>').text(message.name+': ')).appendTo($('#messagesDiv'));
    // $('#messagesDiv')[0].scrollTop = $('#messagesDiv')[0].scrollHeight;
    _.defer(newChar,100);
  });

})

</script>
<script src="./bootstrap/js/bootstrap.min.js"></script>
</body>
</html>